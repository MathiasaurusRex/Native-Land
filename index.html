<!DOCTYPE html>
<html>
  <head>
    <title>Native-land.ca | Our home on native land</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
      <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
      <meta name="keywords" content="first nations maps canada, settler canada, aboriginal maps canada, indigenous map, native-land.ca">
      <meta name="description" content="Welcome to Native-Land.ca. This is a resource for Canadians (and others)
                                        to find out more about local indigenous territories and languages.">

      <!-- <meta property="fb:app_id" content="APP_ID"> -->
      <meta property="og:title" content="Native-Land.ca">
      <meta property="og:description" content="Welcome to Native-Land.ca. This is a resource for Canadians (and others)
                                        to find out more about local indigenous territories and languages.">
      <meta property="og:type" content="website">
      <meta property="og:url" content="http://native-land.ca">
      <meta property="og:image" content="http://native-land.ca/images/large-icon.jpg">
      <meta property="og:site_name" content="Native-Land.ca - Our home on native land">
      <link rel="icon" href="/images/favicon.png" type="image/x-icon"/>
      
    <link rel="stylesheet" href="bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="bootstrap/bootstrap-switch.min.css">
    <style>
      html, body, #map-canvas {
        height: 80%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61451694-1', 'auto');
      ga('send', 'pageview');

    </script>
  </head>
  <body class="container-fluid">
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://native-land.ca">Native-Land.ca</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="http://native-land.ca">Home</a></li>
            <li><a href="http://native-land.ca/full-map.html">Full-screen Map</a></li>
            <li><a href="http://native-land.ca/resources.html">Resources and contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
    </nav>
      
    <div class="row" style="margin-top:40px;">
        <div class="col-md-4">
            <H1>Learn more about where you live.</H1>
            <p>Native-land.ca is a resource to help Canadians learn more about their local history.</p>
            <p><strong>These maps are not definitive OR complete. Boundaries are continually being revised.
                See <a href="resources.html">Resources page</a> for more information. Please <a href="mailto:tempranova@gmail.com">contact me</a> with any fixes or suggestions.</strong></p>
            </ul>
            <input id="autocomplete" class="form-control" placeholder="Enter your town or address." type="text"></input>
        </div>
        <div class="col-md-8">
            <div class="results">
              <table class="table" style="margin-top:20px;">
                  <tr><td>
                    <div style="text-align:center;width:100%;">
                        <h4 style="margin-top:20px;">Please type your address or city into the search box and select from the menu of addresses that appear.</h4>
                        <h5 style="margin-top:20px;">Your search results will appear here.</h5>
                    </div>
                  </td></tr>
              </table>
            </div>
        </div>
    </div>
    <div id="map-canvas" style="margin-top:15px;"></div>
    <div id="currentFN" style="padding:15px;background:white;border-radius:5px;
                            box-shadow:2px 2px 2px #ccc;margin:0 auto;margin-top:30px;
                            font-size:14px;display:none;"></div>
    <div id="legend" style="padding:15px;background:white;border-radius:5px;
                            box-shadow:2px 2px 2px #ccc;font-size:14px;margin-bottom:15px;">
        <table style="text-align:center;">
            <tr>
                <td style="padding:0 5px;"><input type="checkbox" name="territories" data-size="mini"><br>Territories</td>
                <td style="padding:0 5px;"><input type="checkbox" name="languages" data-size="mini"><br>Languages</td>
                <td style="padding:0 5px;"><input type="checkbox" name="treaties" data-size="mini"><br>Treaties</td>
            </tr>
        </table>
    </div>
  </body>

    <script src="https://maps.googleapis.com/maps/api/js?libraries=geometry,places,drawing"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="bootstrap/bootstrap.min.js"></script>
    <script src="bootstrap/bootstrap-switch.min.js"></script>
    <script src="fromgeojson.js"></script>
    <script src="indigineousLanguages.js"></script>
    <script src="indigineousTerritories.js"></script>
    <script src="indigineousTreaties.js"></script>

    <script>
    var map;
    function initialize() {
      var mapOptions = {
        zoom: 3,
        center: new google.maps.LatLng(55.115371, -100.056882),
        mapTypeControlOptions: {
          style: google.maps.MapTypeControlStyle.DEFAULT,
          mapTypeIds: [
            google.maps.MapTypeId.SATELLITE,
            google.maps.MapTypeId.ROADMAP
          ]
        }
      };
      map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);
    
      map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(
        document.getElementById('currentFN')
      );
        
      map.controls[google.maps.ControlPosition.TOP_CENTER].push(
        document.getElementById('legend')
      );
      
    // Stuff for search section
      var autocomplete = new google.maps.places.Autocomplete(
        (document.getElementById('autocomplete')), {
        types: ['geocode']
      });
        
        // Encode stuff loaded in JS file above
        var tryThisGeoJSON = new GeoJSON(thisGeoJSON);


        // Do the stuff after they enter a place        
        google.maps.event.addListener(autocomplete, 'place_changed', function() {
            var place = autocomplete.getPlace();
            if (!place.geometry) {
              return;
            }
            // Making a variety of points all around the central searched point
            console.log(place.geometry.location);
            var thisLatLng = new google.maps.LatLng(place.geometry.location.G,place.geometry.location.K);
            var thisLatLngEast = new google.maps.LatLng(place.geometry.location.G + 0.1,place.geometry.location.K + 0.1);
            var thisLatLngWest = new google.maps.LatLng(place.geometry.location.G + 0.1,place.geometry.location.K - 0.1);
            var thisLatLngNorth = new google.maps.LatLng(place.geometry.location.G - 0.1,place.geometry.location.K - 0.1);
            var thisLatLngSouth = new google.maps.LatLng(place.geometry.location.G - 0.1,place.geometry.location.K + 0.1);
            var thisLatLngArray = [thisLatLng,thisLatLngEast,thisLatLngWest,thisLatLngNorth,thisLatLngSouth];
            var myOptions = {
                center:thisLatLng
            }
            map.setOptions(myOptions);
            var resultsArray = []; // Array with objects having Territory, Language, Link
            // Language search
            var thisLanguage = '';
            tryThisGeoJSON.forEach( function(element,array,index) {
                thisLatLngArray.forEach(function(thisLatLng,array2,index2) {
                    if (google.maps.geometry.poly.containsLocation(thisLatLng, element[0])) {
                        thisLanguage = element[0].geojsonProperties.Name;
                        // Store results into array
                        var languageLinks = element[0].geojsonProperties.description.split(",");
                        var formattedLanguageLinks = [];
                        languageLinks.forEach(function(element,index,array) {
                            var thisLink = ' <a target="_blank" href="'+element+'">'+(index+1)+'</a>';
                            formattedLanguageLinks.push(thisLink);
                        });
                        var finalLanguageLinks = " <i style='font-size:12px;'>(Language links: "+formattedLanguageLinks.join()+")</i>";
                        // Treaty search
                        var thisTreaty = '';
                        var thisTreatyLink = '';
                        var foundTreaty;
                        for(var obj in firstNationsTreaties) {
                            var thisPolygon = new google.maps.Polygon({
                                paths: firstNationsTreaties[obj][1]
                            });
                            if (google.maps.geometry.poly.containsLocation(thisLatLng, thisPolygon)) {
                                foundTreaty = true;
                                thisTreaty = firstNationsTreaties[obj][0];
                                thisTreatyLink = firstNationsTreaties[obj][2];
                            }
                        }
                        console.log(thisTreatyLink);
                        // Territory search
                        var thisTerritory = '';
                        var thisTerritoryLink = '';
                        var foundTerritory;
                        for(var obj in firstNationsTerritories) {
                            var thisPolygon = new google.maps.Polygon({
                                paths: firstNationsTerritories[obj][1]
                            });
                            if (google.maps.geometry.poly.containsLocation(thisLatLng, thisPolygon)) {
                                foundTerritory = true;
                                thisTerritory = firstNationsTerritories[obj][0];
                                thisTerritoryLink = firstNationsTerritories[obj][3];
                                // Check if result is already stored
                                if(resultsArray.length > 0){    
                                    var isItTrue = false;
                                    resultsArray.forEach(function(element3,array3,index3) {
                                        if (element3.territory===thisTerritory) {
                                            isItTrue = true;
                                        }
                                    });
                                    if(isItTrue==false) {
                                        resultsArray.push({
                                            territory    :   thisTerritory,
                                            language     :   thisLanguage,
                                            treaty       :   thisTreaty,
                                            languageLink :   finalLanguageLinks,
                                            territoryLink:   thisTerritoryLink,
                                            treatyLink   :   thisTreatyLink
                                        });
                                    }
                                } else {
                                    // If array is empty
                                    resultsArray.push({
                                        territory    :   thisTerritory,
                                        language     :   thisLanguage,
                                        treaty       :   thisTreaty,
                                        languageLink :   finalLanguageLinks,
                                        territoryLink:   thisTerritoryLink,
                                        treatyLink   :   thisTreatyLink
                                    });
                                }
                            }
                        }
                        if(foundTerritory!==true) {
                            if(foundTreaty!==true) {
                                if(resultsArray.length > 0){   
                                    var isItTrue = false;
                                    resultsArray.forEach(function(element,array,index) {
                                        if(element.language===thisLanguage) {
                                            isItTrue = true;
                                        }
                                    });
                                    if(isItTrue==false) {
                                        resultsArray.push({
                                            territory    :   'None entered yet',
                                            language     :   thisLanguage,
                                            treaty       :   'No treaty',
                                            languageLink :   finalLanguageLinks,
                                            territoryLink:   'none',
                                            treatyLink   :   ''
                                        });
                                    }
                                } else {
                                    resultsArray.push({
                                        territory    :   'None entered yet',
                                        language     :   thisLanguage,
                                        treaty       :   'No treaty',
                                        languageLink :   finalLanguageLinks,
                                        territoryLink:   'none',
                                        treatyLink   :   ''
                                    });
                                }
                            } else {
                                if(resultsArray.length > 0){   
                                    var isItTrue = false;
                                    resultsArray.forEach(function(element,array,index) {
                                        if(element.treaty===thisTreaty) {
                                            isItTrue = true;
                                        }
                                    });
                                    if(isItTrue==false) {
                                        resultsArray.push({
                                            territory    :   'None entered yet',
                                            language     :   thisLanguage,
                                            treaty       :   thisTreaty,
                                            languageLink :   finalLanguageLinks,
                                            territoryLink:   'none',
                                            treatyLink   :   thisTreatyLink
                                        });
                                    }
                                } else {
                                    resultsArray.push({
                                        territory    :   'None entered yet',
                                        language     :   thisLanguage,
                                        treaty       :   thisTreaty,
                                        languageLink :   finalLanguageLinks,
                                        territoryLink:   'none',
                                        treatyLink   :   thisTreatyLink
                                    });
                                }
                            }
                        }
                    }
                });
          });
          $('.results .table').empty();
            // Can add color into results here
          $('.results .table').append('<tr><td><strong>Territory</strong></td><td><strong>Treaty</strong></td><td><strong>Language</strong></td></tr>');
          resultsArray.forEach(function(element,index,array) {
                $('.results .table').append('<tr><td><a target="_blank" href="'+element.territoryLink+'">'+element.territory+'</a></td>'+
                                            '<td><a target="_blank" href="'+element.treatyLink+'">'+
                                            element.treaty+'</td>'+
                                            '<td>'+element.language+
                                            element.languageLink+'</td></tr>');
          });
          $('.results').show();
          $('.searchbar').hide();
        });
        
        // Load areas of language and territories onto map
        var languagePolygons = [];
        var territoryPolygons = [];
        var treatyPolygons = [];
        tryThisGeoJSON.forEach(function(element,array,index) {
            var color = getRandomColor();
            var thisPolygon = element[0];
                thisPolygon.setOptions({strokeColor:color});
                thisPolygon.setOptions({strokeWeight:1});
                thisPolygon.setOptions({fillColor:color});
                thisPolygon.caption = element[0].geojsonProperties.Name;
            languagePolygons.push(thisPolygon);
            // placeLanguages(thisPolygon,map);
        });
        for(var obj in firstNationsTerritories) {
            var color = getRandomColor();
            var thisPolygon = new google.maps.Polygon({
                paths: firstNationsTerritories[obj][1],
                strokeColor: color,
                strokeOpacity: 0.8,
                strokeWeight: 1,
                fillColor: color,
                fillOpacity: 0.35,
                caption: firstNationsTerritories[obj][0]
            });
            territoryPolygons.push(thisPolygon);
            // placeTerritories(thisPolygon,map);
        }
        for(var obj in firstNationsTreaties) {
            var color = getRandomColor();
            var thisPolygon = new google.maps.Polygon({
                paths: firstNationsTreaties[obj][1],
                strokeColor: color,
                strokeOpacity: 0.8,
                strokeWeight: 1,
                fillColor: color,
                fillOpacity: 0.35,
                caption: firstNationsTreaties[obj][0]
            });
            treatyPolygons.push(thisPolygon);
            // placeTreaties(thisPolygon,map);
        }
        // Create checkboxes for turning off and on polygons
        $('input[name="languages"]').bootstrapSwitch();
        $('input[name="territories"]').bootstrapSwitch();
        $('input[name="treaties"]').bootstrapSwitch();
        
        $('input[name="languages"]').on('switchChange.bootstrapSwitch', function(event, state) {
            if(state==true) {
                languagePolygons.forEach(function(element,index,array) {
                    placeLanguages(element,map);
                });
            } else {
                languagePolygons.forEach(function(element,index,array) {
                    element.setMap(null);
                });
            }
        });
        $('input[name="territories"]').on('switchChange.bootstrapSwitch', function(event, state) {
            if(state==true) {
                territoryPolygons.forEach(function(element,index,array) {
                    element.setMap(map);
                    placeTerritories(element,map);
                });
            } else {
                territoryPolygons.forEach(function(element,index,array) {
                    element.setMap(null);
                });
            }
        });
        $('input[name="treaties"]').on('switchChange.bootstrapSwitch', function(event, state) {
            if(state==true) {
                treatyPolygons.forEach(function(element,index,array) {
                    element.setMap(map);
                    placeTreaties(element,map);
                });
            } else {
                treatyPolygons.forEach(function(element,index,array) {
                    element.setMap(null);
                });
            }
        });
    }

    google.maps.event.addDomListener(window, 'load', initialize);

// FUNCTIONS
    // Get random color
    function getRandomColor() {
        var letters = '0123456789ABCDEF'.split('');
        var color = '#';
        for (var i = 0; i < 6; i++ ) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }
        
    // Place territory polygons
    function placeTerritories(element,map) {
        element.setMap(map);
        google.maps.event.addListener(element, 'mouseover', function() {
            this.setOptions({strokeOpacity:1});
            this.setOptions({fillOpacity:0.5});
            $('#currentFN').show();
            $('#currentFN').html(this.caption);
            var textWidth = $('#currentFN').width();
            $('#currentFN').css('margin-left',-textWidth/2);
        });
        google.maps.event.addListener(element, 'mouseout', function() {
            this.setOptions({strokeOpacity:0.8});
            this.setOptions({fillOpacity:0.35});
            $('#currentFN').hide();
        });
    }
        
    // Place language polygons
    function placeLanguages(element,map) {
        element.setMap(map);
        google.maps.event.addListener(element, 'mouseover', function() {
            this.setOptions({strokeOpacity:1});
            this.setOptions({fillOpacity:0.5});
            $('#currentFN').show();
            $('#currentFN').html(this.caption);
            var textWidth = $('#currentFN').width();
            $('#currentFN').css('margin-left',-textWidth/2);
        });
        google.maps.event.addListener(element, 'mouseout', function() {
            this.setOptions({strokeOpacity:0.8});
            this.setOptions({fillOpacity:0.35});
            $('#currentFN').hide();
        });
    }
        
    // Place treaty polygons
    function placeTreaties(element,map) {
        element.setMap(map);
        google.maps.event.addListener(element, 'mouseover', function() {
            this.setOptions({strokeOpacity:1});
            this.setOptions({fillOpacity:0.5});
            $('#currentFN').show();
            $('#currentFN').html(this.caption);
            var textWidth = $('#currentFN').width();
            $('#currentFN').css('margin-left',-textWidth/2);
        });
        google.maps.event.addListener(element, 'mouseout', function() {
            this.setOptions({strokeOpacity:0.8});
            this.setOptions({fillOpacity:0.35});
            $('#currentFN').hide();
        });
    }

    </script>
    <center><h2><a href="full-map.html">See full screen map</a></h2></center>
</html>